import{_ as x,j as p,d as m,e,w as l,F,a,b as h,f as s,g as z,c as E,t as r}from"./index-B2bLNPmI.js";import{D as H,C as N,a as R}from"./DeviceFilter-CmO0ck3c.js";import{_ as $}from"./SearchFilter-DruVarQN.js";const j={name:"FailedTasks",components:{DatePicker:H,ClientFilter:N,DeviceFilter:R,SearchBarFilter:$},data(){return{failTasks:[],showModal:[],searchFilter:"",clientsFilter:[],devicesFilter:[]}},computed:{filteredTasks(){let t=this.failTasks;return console.log(t),this.clientsFilter.length>0&&(t=t.filter(i=>this.clientsFilter.includes(i.last_error.client_id))),t}},mounted(){this.getFailedTasks()},methods:{handleSearch(t){this.searchFilter=t},handleClients(t){this.clientsFilter=t,this.getDevicesByClients()},handleDevices(t){this.devicesFilter=t,console.log("DEVICES: ",t)},handleDevices(t){this.devicesFilter=t},async getFailedTasks(){const t=await p.get(this.$store.state.backendUrl+"/syncManual",{headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.$store.state.token}});this.failTasks=t.data,console.log(this.failTasks)},async getDevicesByClients(){try{let t=[];for(const i of this.clientsFilter){const f=await p.get(this.$store.state.backendUrl+"/devices",{params:{client_id:i,clientConfig:!0},headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.$store.state.token}});t=t.concat(f.data.map(u=>({...u,host:u.client_config.zeusHost})))}this.devicesFilter=t}catch(t){console.error("Error en la solicitud a la API:",t),this.ShowError=!0}}}};function A(t,i,f,u,T,d){const v=a("ClientFilter"),_=a("CCol"),b=a("DeviceFilter"),g=a("SearchBarFilter"),k=a("CButton"),B=a("CRow"),o=a("CTableHeaderCell"),C=a("CTableRow"),D=a("CTableHead"),n=a("CTableDataCell"),y=a("CTableBody"),w=a("CTable");return h(),m(F,null,[e(B,null,{default:l(()=>[e(_,{class:"col-3"},{default:l(()=>[e(v,{onFilter:d.handleClients},null,8,["onFilter"])]),_:1}),e(_,{class:"col-3"},{default:l(()=>[e(b,{devices:T.devicesFilter,onFilter:d.handleDevices},null,8,["devices","onFilter"])]),_:1}),e(_,{class:"col-4"},{default:l(()=>[e(g,{onSearch:d.handleSearch},null,8,["onSearch"])]),_:1}),e(_,{class:"col-2"},{default:l(()=>[e(k)]),_:1})]),_:1}),e(w,{class:"mt-4",striped:"",bordered:""},{default:l(()=>[e(D,null,{default:l(()=>[e(C,null,{default:l(()=>[e(o,{scope:"col"},{default:l(()=>[s("Cliente")]),_:1}),e(o,{scope:"col"},{default:l(()=>[s("Nombre")]),_:1}),e(o,{scope:"col"},{default:l(()=>[s("CÃ³digo zeus")]),_:1}),e(o,{scope:"col"},{default:l(()=>[s("Fecha")]),_:1}),e(o,{scope:"col"},{default:l(()=>[s("Error")]),_:1})]),_:1})]),_:1}),e(y,null,{default:l(()=>[(h(!0),m(F,null,z(d.filteredTasks,(c,S)=>(h(),E(C,{key:S},{default:l(()=>[e(n,null,{default:l(()=>[s(r(c.client.name),1)]),_:2},1024),e(n,null,{default:l(()=>[s(r(c.device.zeusName),1)]),_:2},1024),e(n,null,{default:l(()=>[s(r(c.device.zeusCode),1)]),_:2},1024),e(n,null,{default:l(()=>[s(r(c.last_error.updated_at),1)]),_:2},1024),e(n,null,{default:l(()=>[s(r(c.last_error.message),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})],64)}const P=x(j,[["render",A]]);export{P as default};
