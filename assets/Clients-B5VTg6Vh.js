import{_ as E,j as D,a as l,b,c as g,w as t,e as o,f as s,t as y,i as F,C as x,d as B,h as $,F as A,g as z}from"./index-8UleF4ZQ.js";import{_ as R}from"./SearchFilter-B183IJ57.js";import{i as I}from"./index-CYE9aSFO.js";import{u as S,r as V}from"./index-5FCShcH-.js";import"./index-Cp4zSSMc.js";import"./index-Cw_ppwa_.js";import"./index-C6AE5JqC.js";const U={name:"AddClient",props:{showAddModal:Boolean},setup(){return{v$:S()}},emits:["cerrarAddModal"],data(){return{form:{name:""},success:!1,successMsg:""}},validations(){return{form:{name:{required:V}}}},methods:{closeModal(){this.$emit("cerrarAddModal"),this.success=!1,this.form.name="",this.v$.$reset()},closeModalOutside(e){e.target===e.currentTarget&&this.closeModal()},setTouched(e){(e=="name"||e=="all")&&this.v$.form.name.$touch()},saveClient(){this.setTouched("all"),this.v$.$invalid||D.post(this.$store.state.backendUrl+"/clients",this.form,{headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.$store.state.token}}).then(e=>{console.log(e),this.successMsg="Cliente añadido exitósamente.",this.success=!0}).catch(e=>{console.log("Error en post: ",e)})}}};function j(e,d,f,C,a,n){const _=l("CModalTitle"),c=l("CModalHeader"),i=l("CAlert"),u=l("CFormInput"),r=l("CForm"),m=l("CModalBody"),h=l("CButton"),v=l("CModalFooter"),M=l("CModal");return b(),g(M,{visible:f.showAddModal,onClose:n.closeModal},{default:t(()=>[o(c,null,{default:t(()=>[o(_,null,{default:t(()=>[s("Nuevo Cliente")]),_:1})]),_:1}),o(m,null,{default:t(()=>[o(i,{color:"success",visible:a.success},{default:t(()=>[s(y(a.successMsg),1)]),_:1},8,["visible"]),o(r,null,{default:t(()=>[o(u,{type:"text",placeholder:"Nombre","aria-describedby":"Nombre Cliente",onInput:d[0]||(d[0]=p=>n.setTouched("name")),modelValue:a.form.name,"onUpdate:modelValue":d[1]||(d[1]=p=>a.form.name=p),feedback:"Rellene este campo por favor.",invalid:C.v$.form.name.$error},null,8,["modelValue","invalid"])]),_:1})]),_:1}),o(v,null,{default:t(()=>[o(h,{color:"secondary",onClick:n.closeModal},{default:t(()=>[s(" Cerrar ")]),_:1},8,["onClick"]),o(h,{color:"primary",onClick:n.saveClient},{default:t(()=>[s("Guardar")]),_:1},8,["onClick"])]),_:1})]),_:1},8,["visible","onClose"])}const O=E(U,[["render",j]]),P={name:"DeleteModal",props:{showDeleteModal:Boolean,client:Object},data(){return{}},emits:["closeDeleteModal"],methods:{closeModal(){this.$emit("closeDeleteModal")},deleteProduct(){}}};function L(e,d,f,C,a,n){const _=l("CModalTitle"),c=l("CModalHeader"),i=l("CModalBody"),u=l("CButton"),r=l("CModalFooter"),m=l("CModal");return b(),g(m,{visible:f.showDeleteModal,onClose:n.closeModal},{default:t(()=>[o(c,null,{default:t(()=>[o(_,null,{default:t(()=>[F(e.$slots,"modalTitle")]),_:3})]),_:3}),o(i,null,{default:t(()=>[F(e.$slots,"modalBody")]),_:3}),o(r,null,{default:t(()=>[o(u,{onClick:n.deleteProduct,color:"danger",class:"text-white"},{default:t(()=>[s("Eliminar ")]),_:1},8,["onClick"]),o(u,{color:"primary",onClick:n.closeModal},{default:t(()=>[s("Cancelar")]),_:1},8,["onClick"])]),_:1})]),_:3},8,["visible","onClose"])}const q=E(P,[["render",L]]),G={name:"EditUser",components:{CIcon:x,DeleteModal:q},emits:["update:showEditModal","cerrarEditModal"],props:{showEditModal:Boolean,client:Object},setup(){return{v$:S(),icon:I}},validations(){return{form:{name:{required:V}}}},data(){return{form:{id:"",name:""},showDeleteModal:!1,success:!1,successMsg:""}},emits:["onUpdate:showEditModal","cerrarEditModal"],watch:{client:{handler(e){this.setDataClient(e)},deep:!0,immediate:!0},showEditModal(e){e||this.$emit("update:showEditModal")}},methods:{setTouched(e){(e=="name"||e=="all")&&this.v$.form.name.$touch()},handleDeleteModal(){this.showDeleteModal=!0},closeModal(){this.$emit("cerrarEditModal"),this.success=!1},closeModalOutside(e){e.target===e.currentTarget&&this.closeModal()},setDataClient(e){e&&(console.log(e),this.form.id=e.id,this.form.name=e.name)},saveClient(){this.setTouched("all"),this.v$.$invalid||D.put(this.$store.state.backendUrl+"/clients/"+this.form.id,this.form,{headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.$store.state.token}}).then(e=>{console.log(e),this.successMsg="Cliente actualizado exitósamente.",this.success=!0}).catch(e=>{console.log("Error en post: ",e)})},onCloseDeleteModal(){console.log("cerre modal Delete Modal"),this.showDeleteModal=!1}}},J=$("b",null,"ADVERTENCIA:",-1);function K(e,d,f,C,a,n){const _=l("CModalTitle"),c=l("CModalHeader"),i=l("CAlert"),u=l("CIcon"),r=l("CButton"),m=l("CFormInput"),h=l("CForm"),v=l("CModalBody"),M=l("CModalFooter"),p=l("CModal"),T=l("DeleteModal");return b(),B(A,null,[o(p,{visible:f.showEditModal,onClose:n.closeModal},{default:t(()=>[o(c,null,{default:t(()=>[o(_,null,{default:t(()=>[s("Editar Cliente")]),_:1})]),_:1}),o(v,null,{default:t(()=>[o(i,{color:"success",visible:a.success},{default:t(()=>[s(y(a.successMsg),1)]),_:1},8,["visible"]),$("div",null,[o(r,{color:"danger",variant:"outline",onClick:n.handleDeleteModal},{default:t(()=>[o(u,{icon:C.icon.cilTrash,size:"lg"},null,8,["icon"])]),_:1},8,["onClick"])]),o(h,{class:"mt-3"},{default:t(()=>[o(m,{type:"text",placeholder:"Nombre","aria-describedby":"Nombre Cliente",modelValue:a.form.name,"onUpdate:modelValue":d[0]||(d[0]=w=>a.form.name=w),onInput:d[1]||(d[1]=w=>n.setTouched("name")),feedback:"Rellene este campo por favor.",invalid:C.v$.form.name.$error,class:"mt-3"},null,8,["modelValue","invalid"])]),_:1})]),_:1}),o(M,null,{default:t(()=>[o(r,{color:"secondary",onClick:n.closeModal},{default:t(()=>[s(" Cerrar ")]),_:1},8,["onClick"]),o(r,{color:"primary",onClick:n.saveClient},{default:t(()=>[s("Guardar")]),_:1},8,["onClick"])]),_:1})]),_:1},8,["visible","onClose"]),o(T,{showDeleteModal:a.showDeleteModal,onCloseDeleteModal:n.onCloseDeleteModal,client:a.form},{modalTitle:t(()=>[s("Eliminar Cliente")]),modalBody:t(()=>[J,s(" Se eliminarán todos los datos de este cliente. ")]),modalFooter:t(()=>[]),_:1},8,["showDeleteModal","onCloseDeleteModal","client"])],64)}const Q=E(G,[["render",K]]),W={name:"Clients",components:{SearchBarFilter:R,CIcon:x,AddClientModal:O,EditClientModal:Q},setup(){return{icon:I}},data(){return{clients:[],searchFilter:"",showAddModal:!1,showEditModal:!1,client_id:null}},computed:{filteredClients(){let e=this.clients;return this.searchFilter!==""&&(e=e.filter(d=>d.name.toLowerCase().includes(this.searchFilter.toLowerCase()))),e}},mounted(){this.getClients()},methods:{editClient(e){this.showEditModal=!0,this.client_id=e},addClient(){this.showAddModal=!0},handleSearch(e){this.searchFilter=e},async getClients(){try{const e=await D.get(this.$store.state.backendUrl+"/clients",{headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.$store.state.token}});this.clients=e.data,console.log(this.clients[0])}catch(e){console.error("Error en la solicitud a la API:",e),this.ShowError=!0}},onCloseAdd(){this.showAddModal=!1,this.getClients()},onCloseEdit(){console.log("cerré modal editClient"),this.showEditModal=!1,this.getClients()}}};function X(e,d,f,C,a,n){const _=l("CIcon"),c=l("CButton"),i=l("CCol"),u=l("SearchBarFilter"),r=l("CRow"),m=l("CTableHeaderCell"),h=l("CTableRow"),v=l("CTableHead"),M=l("CTableDataCell"),p=l("font-awesome-icon"),T=l("CTableBody"),w=l("CTable"),H=l("AddClientModal"),N=l("EditClientModal");return b(),B(A,null,[o(r,{class:"mb-4"},{default:t(()=>[o(i,{class:"col-3 mt-4"},{default:t(()=>[o(c,{onClick:n.addClient,color:"success",shape:"rounded-pill",variant:"outline"},{default:t(()=>[o(_,{icon:C.icon.cilPlus,size:"xl"},null,8,["icon"])]),_:1},8,["onClick"])]),_:1}),o(i,{class:"col-9"},{default:t(()=>[o(u,{onSearch:n.handleSearch},null,8,["onSearch"])]),_:1})]),_:1}),o(w,{class:"mt-5"},{default:t(()=>[o(v,null,{default:t(()=>[o(h,{color:"dark"},{default:t(()=>[o(m,{scope:"col"},{default:t(()=>[s("Nombre")]),_:1}),o(m,{scope:"col"},{default:t(()=>[s("Editar")]),_:1})]),_:1})]),_:1}),o(T,null,{default:t(()=>[(b(!0),B(A,null,z(n.filteredClients,(k,Y)=>(b(),g(h,{key:k.id},{default:t(()=>[o(M,null,{default:t(()=>[s(y(k.name),1)]),_:2},1024),o(M,null,{default:t(()=>[o(c,{onClick:Z=>n.editClient(k)},{default:t(()=>[o(p,{icon:"pen-to-square",size:"xl"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),o(H,{showAddModal:a.showAddModal,onCerrarAddModal:n.onCloseAdd},null,8,["showAddModal","onCerrarAddModal"]),o(N,{showEditModal:a.showEditModal,client:a.client_id,onCerrarEditModal:n.onCloseEdit},null,8,["showEditModal","client","onCerrarEditModal"])],64)}const de=E(W,[["render",X]]);export{de as default};
